<!-- SOURCES: 
https://www.w3schools.com/html/html5_video.asp
https://www.geeksforgeeks.org/javascript/how-to-get-all-html-content-from-domparser-excluding-the-outer-body-tag/
-->
<!DOCTYPE html>
<html>
  <head>
    <title>Progressive Video Downloader</title>
    <style>
      html {
        color-scheme: light dark;
      }
      body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
      }
    </style>
  </head>
  <body>
    <h1>Progressive Video Downloader</h1>

    <p>
      If you see this page, the nginx web server is successfully installed and
      working. Further configuration is required.
    </p>
    <video width="640" height="360" controls>
      <source src="videos/1.mp4" type="video/mp4" />
      Your browser does not support the video tag.
    </video>

    <p>Select a video to play:</p>
    <select id="videoSelect"></select>
    <video id="videoPlayer" width="640" height="360" controls>
      <source id="videoSource" type="video/mp4" />
      Your browser does not support the video tag.
    </video>
    <script>
      const VIDEO_DIR = "/videos/";

      // Use these elements to configure the player --> which video to play?
      const videoSelect = document.getElementById("videoSelect");
      const videoPlayer = document.getElementById("videoPlayer");
      const videoSource = document.getElementById("videoSource");

      fetch(VIDEO_DIR)
        .then((response) => response.text())
        .then((html) => {
          // LOL super stupid mistake --> this will actually open the printing interface and attempt to print the page XD
          //print(html);

          // "Prints" the whole HTML list of the contents in /videos/ in the browser console
          console.log(html);

          // Parse document and retrieve all video names
          const parser = new DOMParser();
          const parsedDocument = parser.parseFromString(html, "text/html");

          // Get all files in /videos/ --> they are provided as links in the HTML list
          const links = parsedDocument.querySelectorAll("a");

          links.forEach((link) => {
            // The file name is specified in the href attribute of the hyperlink element
            const filename = link.getAttribute('href');

            // Filter for .mp4 files --> only these are relevant for selection/downloading
            if(filename && filename.endsWith('.mp4')){

                // Create selectable options based on the available videos on the server
                const option = document.createElement("option");
                option.value = VIDEO_DIR + filename;
                option.text = filename;
                videoSelect.appendChild(option);
            }
          });
        });
    </script>
  </body>
</html>
